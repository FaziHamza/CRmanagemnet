<nz-spin [nzSpinning]="saveLoader" [nzSize]="'large'">
    <form [formGroup]="orderForm" (ngSubmit)="saveForm()">
        <div class="content-body-inner">

            <div class="create-order-row">
                <h5>
                    Create Order
                </h5>
            </div>
            <div class="create-form">
                <div class="form-title">
                    <h4>
                        Customer
                    </h4>
                </div>
                <div class="form">

                    <div class="row">
                        <div class="col-lg-3 col-md-6">
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label">Full Name <span
                                        class="text-danger">*</span></label>
                                <input type="text" placeholder="Type name or Phone No National ID..."
                                    class="form-control" id="exampleInputEmail1" nz-input
                                    [ngModelOptions]="{ standalone: true }" [(ngModel)]="customerId"
                                    (ngModelChange)="onChangeName($event)" [nzAutocomplete]="customerName" />
                                <nz-autocomplete #customerName>
                                    <nz-auto-option *ngFor="let option of customerList" [nzValue]="option.customerId"
                                        [nzLabel]="option.customerName">
                                        {{ option.customerName }}
                                    </nz-auto-option>
                                </nz-autocomplete>
                                <div class="text-danger">
                                    <div
                                        *ngIf="(orderForm.get('customerName').invalid && (orderForm.get('customerName').touched || saveSubmitted)) || (!orderForm.get('customerName').value && saveSubmitted)">
                                        <div *ngIf="formControls['customerName'].errors?.['required']">
                                            This field is required.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Phone Number</label>
                                <input type="text" class="form-control" disabled placeholder="Phone Number"
                                    formControlName="mobile">
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="mb-3">
                                <label class="form-label">National ID </label>
                                <input type="text" class="form-control" disabled placeholder="National ID "
                                    formControlName="nationalId">
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="mb-3">
                                <label for="exampleInputCardNo" class="form-label">Card No, <span
                                        class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="exampleInputCardNo" formControlName="cardNo"
                                    placeholder="Type Number">

                                <div class="text-danger">
                                    <div
                                        *ngIf="(orderForm.get('cardNo').invalid && (orderForm.get('cardNo').touched || saveSubmitted)) || (!orderForm.get('cardNo').value && saveSubmitted)">
                                        <div *ngIf="formControls['cardNo'].errors?.['required']">
                                            This field is required.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <hr>
            <div class="card">
                <div class="card-heading">
                    <div class="head-left">
                        <h5 class="card-subheading">Added Spare Parts</h5>
                    </div>
                    <div class="head-right">
                        <button class="btn btn-round" type="button" (click)="addRow()">
                            <i class="fa fa-plus"></i>
                        </button>
                    </div>
                </div>

                <div class="table-responsive">
                    <nz-table #editRowTable nzBordered [nzData]="listOfData" nzTableLayout="fixed"
                        [nzPageSize]="pageSize" [nzLoading]="tableLoader">
                        <thead>
                            <tr>
                                <th nzWidth="15%">Part No</th>
                                <th nzWidth="15%">Description</th>
                                <th>Qty</th>
                                <th nzWidth="10%">Unit Price</th>
                                <th>Discount</th>
                                <th>Net</th>
                                <th>Tax</th>
                                <th nzWidth="10%">Total Price</th>
                                <th nzWidth="10%"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of editRowTable.data;let index = index">
                                <ng-container *ngIf="!editCache[data.id].edit; else editTemplate">
                                    <td>{{ data.partQtyConcat }}</td>
                                    <td>{{ data.description }}</td>
                                    <td>{{ data.qty }}</td>
                                    <td>{{ data.unitofMeasure }}</td>
                                    <td>{{ data.discount }} %</td>
                                    <td>{{ data.net | number:'1.2-2'}}</td>
                                    <td>{{ data.tax }} %</td>
                                    <td>{{ data.totalPrice | number:'1.2-2'}}</td>
                                    <td>
                                        <a (click)="startEdit(data.id)" class="pen-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                viewBox="0 0 24 24">
                                                <path fill="none" stroke="currentColor" stroke-linecap="round"
                                                    stroke-width="1.5"
                                                    d="M4 22h4m12 0h-8m1.888-18.337l.742-.742a3.146 3.146 0 1 1 4.449 4.45l-.742.74m-4.449-4.448s.093 1.576 1.483 2.966c1.39 1.39 2.966 1.483 2.966 1.483m-4.449-4.45L7.071 10.48c-.462.462-.693.692-.891.947a5.24 5.24 0 0 0-.599.969c-.139.291-.242.601-.449 1.22l-.875 2.626m14.08-8.13L14.93 11.52m-3.41 3.41c-.462.462-.692.692-.947.891c-.3.234-.625.435-.969.599c-.291.139-.601.242-1.22.448l-2.626.876m0 0l-.641.213a.848.848 0 0 1-1.073-1.073l.213-.641m1.501 1.5l-1.5-1.5" />
                                            </svg>
                                        </a>
                                        <a nz-popconfirm nzPopconfirmTitle="Sure to delete?"
                                            (nzOnConfirm)="deleteRow(data)" class="delete-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                viewBox="0 0 24 24">
                                                <g fill="none" stroke="currentColor" stroke-linecap="round"
                                                    stroke-width="1.5">
                                                    <path d="M9.17 4a3.001 3.001 0 0 1 5.66 0" opacity=".5" />
                                                    <path
                                                        d="M20.5 6h-17m15.333 2.5l-.46 6.9c-.177 2.654-.265 3.981-1.13 4.79c-.865.81-2.195.81-4.856.81h-.774c-2.66 0-3.99 0-4.856-.81c-.865-.809-.953-2.136-1.13-4.79l-.46-6.9" />
                                                    <path d="m9.5 11l.5 5m4.5-5l-.5 5" opacity=".5" />
                                                </g>
                                            </svg>
                                        </a>
                                    </td>

                                </ng-container>
                                <ng-template #editTemplate>
                                    <td>
                                        <div class="example-input">
                                            <input placeholder='Part No' nz-input
                                                [(ngModel)]="editCache[data.id].data.partQtyConcat"
                                                [ngModelOptions]="{ standalone: true }"
                                                (ngModelChange)="onChange($event,data.id)" [nzAutocomplete]="auto" />
                                            <nz-autocomplete #auto>
                                                <nz-auto-option *ngFor="let option of filteredOptions"
                                                    [nzValue]="option.id" [nzLabel]="option.partQtyConcat">
                                                    {{ option.partQtyConcat }}
                                                </nz-auto-option>
                                            </nz-autocomplete>
                                        </div>
                                    </td>
                                    <td><input type="text" [disabled]="true" nz-input
                                            [(ngModel)]="editCache[data.id].data.description"
                                            [ngModelOptions]="{ standalone: true }" /></td>
                                    <td><input type="number" (ngModelChange)="onChangeQty($event,data.id)" nz-input
                                            [(ngModel)]="editCache[data.id].data.qty"
                                            [ngModelOptions]="{ standalone: true }" /></td>
                                    <td><input type="number" [disabled]="true" nz-input
                                            [(ngModel)]="editCache[data.id].data.unitofMeasure "
                                            [ngModelOptions]="{ standalone: true }" /></td>
                                    <td><input type="number" nz-input (ngModelChange)="onChangeDiscount($event,data.id)"
                                            [(ngModel)]="editCache[data.id].data.discount"
                                            [ngModelOptions]="{ standalone: true }" /></td>
                                    <td><input type="number" [disabled]="true" nz-input
                                            [(ngModel)]="editCache[data.id].data.net"
                                            [ngModelOptions]="{ standalone: true }" /></td>
                                    <td><input type="number" nz-input (ngModelChange)="onChangeTax($event,data.id)"
                                            [(ngModel)]="editCache[data.id].data.tax"
                                            [ngModelOptions]="{ standalone: true }" /></td>
                                    <td><input type="number" [disabled]="true" nz-input
                                            [(ngModel)]="editCache[data.id].data.totalPrice"
                                            [ngModelOptions]="{ standalone: true }" /></td>
                                    <td>
                                        <a (click)="saveEdit(data.id)" class="save pen-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" style="color:#49a1bb"
                                                viewBox="0 0 24 24">
                                                <path fill="currentColor"
                                                    d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3s3-1.34 3-3s-1.34-3-3-3zM6 6h9v4H6z" />
                                            </svg>

                                        </a>
                                        <a nz-popconfirm nzPopconfirmTitle="Sure to cancel?"
                                            (nzOnConfirm)="cancelEdit(data.id)" class="delete-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                viewBox="0 0 24 24">
                                                <g fill="none" stroke="currentColor" stroke-linecap="round"
                                                    stroke-width="1.5">
                                                    <path d="M9.17 4a3.001 3.001 0 0 1 5.66 0" opacity=".5" />
                                                    <path
                                                        d="M20.5 6h-17m15.333 2.5l-.46 6.9c-.177 2.654-.265 3.981-1.13 4.79c-.865.81-2.195.81-4.856.81h-.774c-2.66 0-3.99 0-4.856-.81c-.865-.809-.953-2.136-1.13-4.79l-.46-6.9" />
                                                    <path d="m9.5 11l.5 5m4.5-5l-.5 5" opacity=".5" />
                                                </g>
                                            </svg>

                                        </a>
                                    </td>
                                </ng-template>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
            </div>
            <div class="card">
                <div class="grand-amount-card">
                    <div class="add-note">
                        <h4>Add Note</h4>
                        <textarea name="" id="" rows="3" formControlName="salesNote"></textarea>
                    </div>
                    <div class="total-amount">
                        <h4 class="card-subheading">Grand Amount</h4>
                        <button type="button" class="btn btn-secondary">{{grandTotal | number:'1.2-2'}} JD</button>
                    </div>
                </div>
            </div>
            <div class="card payment-method-card ">
                <div class="row">
                    <div class="col-lg-4">
                        <h4 class="card-subheading">Payment Method</h4>
                        <div class="radio-btns">
                            <div class="form-check">
                                <input class="form-check-input" [(ngModel)]="paymentMethodName" type="radio"
                                    formControlName="paymentType" value="cash" id="flexRadioDefault1">
                                <label class="form-check-label" for="flexRadioDefault1">
                                    Cash
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" [(ngModel)]="paymentMethodName" type="radio"
                                    formControlName="paymentType" value="pn" id="flexRadioDefault2">
                                <label class="form-check-label" for="flexRadioDefault2">
                                    PN
                                </label>
                            </div>
                        </div>
                        <div class="text-danger">
                            <div
                                *ngIf="(orderForm.get('paymentType').invalid && (orderForm.get('paymentType').touched || saveSubmitted)) || (!orderForm.get('paymentType').value && saveSubmitted)">
                                <div *ngIf="formControls['paymentType'].errors?.['required']">
                                    This field is required.
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-8">
                        <div *ngIf="paymentMethodName == 'pn'">
                            <div class="row">
                                <div class="col-lg-6 col-md-6">
                                    <div class="mb-3">
                                        <h4 class="card-subheading">Start Date *</h4>
                                        <input type="date" class="form-control date-input" placeholder="Start Date"
                                            formControlName="pnStartDate">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <div class="mb-3">
                                        <h4 class="card-subheading">End Date *</h4>
                                        <input type="date" class="form-control date-input" placeholder="End Date"
                                            formControlName="pnEndDate">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>



                <div class="bottom-buttons">
                    <button type="button" class="btn btn-white hvr-bounce-to-right2" [routerLink]="'/home/allorder'">Cancel</button>
                    <button class="btn o-btn hvr-bounce-to-right" type="submit">Create</button>
                </div>
            </div>
        </div>
    </form>
</nz-spin>